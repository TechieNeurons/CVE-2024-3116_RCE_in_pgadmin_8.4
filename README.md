# CVE-2024-3116_RCE_in_pgadmin_8.4
Making a lab and testing the CVE-2024-3116, a Remote Code Execution in pgadmin &lt;=8.4

I used [this article](https://ayoubmokhtar.com/post/remote_code_execution_pgadmin_8.4-cve-2024-3116/) as a baseline.

## Installation of the lab

First thing first a little comment on this lab, the documentation of pgadmin is pretty bad and I didn't find any trace of anybody installing pgadmin on windows...

1. The author said the vulnerability is present only on windows so I'll use the windows 11 VM given by Microsoft ([here](https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/))
2. After installing the VM, I Install *python 3.10.0* (I made some test with 3.11 and 3.12 but I get some dependancies issues so lets go with 3.10)
3. Install *postgresql 16.2* (without pgadmin, and I put password as a password for my postgresql, not very important in our case)
4. It’s recommended to install pgadmin in a python virtualenv, I tried and that didn’t worked so F*CK VENV ! 
5. update pip : `python -m pip install -U pip`
6. Install wheel : `python -m pip install wheel`
7. Download source : https://www.postgresql.org/ftp/pgadmin/pgadmin4/ > 8.4 > pip > download .whl file
8. Install pgadmin4 : `python -m pip install C:\Users\User\Downloads\pgadmin4-8.4-py3-none-any.whl`
    - Folder of installation : `C:\Users\User\AppData\Local\Programs\Python\Python310\Lib\site-packages\pgadmin4`
9. Let’s configure : 
    - In the file : `C:\Users\User\AppData\Local\Programs\Python\Python310\Lib\site-packages\pgadmin4\config_local.py`, add the following line : 

```
LOG_FILE = r'C:\Users\User\pgadmin4\log\pgadmin4.log'
SQLITE_PATH = r'C:\Users\User\pgadmin4\pgadmin4.db'
SESSION_DB_PATH = r'C:\Users\User\pgadmin4\sessions'
STORAGE_DIR = r'C:\Users\User\pgadmin4\storage'
SERVER_MODE = True 
```

    - Create the folders that doesn’t exist (pgadmin4\log, pgadmin4\sessions, pgadmin4\storage)
    - Create the folder : `C:\Users\User\AppData\Roaming\pgAdmin`
    - In the folder of pgadmin4 launch : `python site-packages/pgadmin4/setup.py setup-db`, I put *Email = toto@exploit.loc* and *Password = password* (this email and password are important because we need them to connect to pgadmin)

Then the server : 
Install XAMPP (can uncheck everything, just need apache)
Add the environment variable : `MOD_WSGI_APACHE_ROOTDIR = C:/xampp/apache`
Install mod-wsgi : `pip install mod-wsgi`
Get the configuration : `mod_wsgi-express module-config`
Copy the result of the previous command at the end of the `httpd.conf` file of apache
To finish launch the server, should be accessible on port 8000: `mod_wsgi-express start-server .\pgAdmin4.wsgi`
